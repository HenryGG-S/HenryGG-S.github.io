---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection, getEntryBySlug } from "astro:content";

export async function getStaticPaths() {
  const projects = (await getCollection("projects")).filter((p) => !p.data.draft);
  return projects.map((p) => ({ params: { slug: p.slug } }));
}

const { slug } = Astro.params;
const entry = await getEntryBySlug("projects", slug);

if (!entry) throw new Error(`Missing project: ${slug}`);

const { Content } = await entry.render();
const { title, description, repo, demo, tags, date } = entry.data;
---

<BaseLayout title={`${title} — Henry George Grantham-Smith`} description={description}>
  <a class="muted" href="/projects/">← Back</a>

  <h1 style="margin-top:10px;">{title}</h1>
  <p class="muted">{description}</p>

  <div class="nav">
    {repo ? <a href={repo}>Repo</a> : null}
    {demo ? <a href={demo}>Demo</a> : null}
    <span class="muted">{date.toISOString().slice(0, 10)}</span>
  </div>

  <div class="muted" style="margin-bottom:18px;">
    {tags.map((t) => <span>#{t} </span>)}
  </div>

  <article class="card">
    <Content />
  </article>
</BaseLayout>

